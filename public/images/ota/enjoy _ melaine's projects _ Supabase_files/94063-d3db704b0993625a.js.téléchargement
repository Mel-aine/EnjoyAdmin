try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="e426d38e-895a-4dfb-9d17-c04324459437",e._sentryDebugIdIdentifier="sentry-dbid-e426d38e-895a-4dfb-9d17-c04324459437")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94063],{107:(e,t,a)=>{var n=a(50117),r=a(94277),s=Object.prototype.hasOwnProperty;e.exports=r(function(e,t,a){s.call(e,a)?e[a].push(t):n(e,a,[t])})},6712:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(86848).A)("Vault",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}],["path",{d:"m7.9 7.9 2.7 2.7",key:"hpeyl3"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}],["path",{d:"m13.4 10.6 2.7-2.7",key:"264c1n"}],["circle",{cx:"7.5",cy:"16.5",r:".5",fill:"currentColor",key:"nkw3mc"}],["path",{d:"m7.9 16.1 2.7-2.7",key:"p81g5e"}],["circle",{cx:"16.5",cy:"16.5",r:".5",fill:"currentColor",key:"fubopw"}],["path",{d:"m13.4 13.4 2.7 2.7",key:"abhel3"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},11658:(e,t,a)=>{"use strict";a.d(t,{y:()=>m});var n=a(72112),r=a(65471),s=a(12957),o=a(70825),i=a(27664),l=a(58350),c=a(80090),d=a(9620),u=a(60734);let m=()=>{var e,t,a,m;let{data:y}=(0,d.YA)(),{data:p}=(0,i.G)({projectRef:null==y?void 0:y.ref}),f=null!=(m=null==p||null==(e=p.app_config)?void 0:e.protocol)?m:"https",h=(null==p||null==(t=p.app_config)?void 0:t.storage_endpoint)||(null==p||null==(a=p.app_config)?void 0:a.endpoint),g=r.V4.find(e=>"s3_vectors_wrapper"===e.name),{can:x}=(0,c.Qp)(n.aG.STORAGE_ADMIN_WRITE,"*"),{mutateAsync:b,isPending:k}=(0,u.S)(),{mutateAsync:v,isPending:j}=(0,l.m_)();return{mutateAsync:async e=>{var t;let{bucketName:a}=e,n=await b({projectRef:null==y?void 0:y.ref,description:(0,o.YF)(a)}),r=(0,o.Eo)(a),i={projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString,wrapperMeta:g,formState:{wrapper_name:r,server_name:"".concat(r,"_server"),vault_access_key_id:null==n?void 0:n.access_key,vault_secret_access_key:null==n?void 0:n.secret_key,aws_region:p.region,endpoint_url:(0,s.oA)(null!=(t=null==y?void 0:y.ref)?t:"",f,h),supabase_target_schema:(0,o.Xn)(a)},mode:"skip",tables:[],sourceSchema:"",targetSchema:""};await v(i)},isPending:j||k,hasPermission:x}}},19686:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>c});var n={};a.r(n),a.d(n,{BRAND:()=>i.qt,DIRTY:()=>s.jm,EMPTY_PATH:()=>s.I3,INVALID:()=>s.uY,NEVER:()=>i.tm,OK:()=>s.OK,ParseStatus:()=>s.MY,Schema:()=>i.Sj,ZodAny:()=>i.Ml,ZodArray:()=>i.n,ZodBigInt:()=>i.Lr,ZodBoolean:()=>i.WF,ZodBranded:()=>i.eN,ZodCatch:()=>i.hw,ZodDate:()=>i.aP,ZodDefault:()=>i.Xi,ZodDiscriminatedUnion:()=>i.jv,ZodEffects:()=>i.k1,ZodEnum:()=>i.Vb,ZodError:()=>l.G,ZodFirstPartyTypeKind:()=>i.kY,ZodFunction:()=>i.CZ,ZodIntersection:()=>i.Jv,ZodIssueCode:()=>l.eq,ZodLazy:()=>i.Ih,ZodLiteral:()=>i.DN,ZodMap:()=>i.Ut,ZodNaN:()=>i.Tq,ZodNativeEnum:()=>i.WM,ZodNever:()=>i.iS,ZodNull:()=>i.PQ,ZodNullable:()=>i.l1,ZodNumber:()=>i.rS,ZodObject:()=>i.bv,ZodOptional:()=>i.Ii,ZodParsedType:()=>o.Zp,ZodPipeline:()=>i._c,ZodPromise:()=>i.$i,ZodReadonly:()=>i.EV,ZodRecord:()=>i.b8,ZodSchema:()=>i.lK,ZodSet:()=>i.Kz,ZodString:()=>i.ND,ZodSymbol:()=>i.K5,ZodTransformer:()=>i.BG,ZodTuple:()=>i.y0,ZodType:()=>i.aR,ZodUndefined:()=>i._Z,ZodUnion:()=>i.fZ,ZodUnknown:()=>i._,ZodVoid:()=>i.a0,addIssueToContext:()=>s.zn,any:()=>i.bz,array:()=>i.YO,bigint:()=>i.o,boolean:()=>i.zM,coerce:()=>i.au,custom:()=>i.Ie,date:()=>i.p6,datetimeRegex:()=>i.fm,defaultErrorMap:()=>r.su,discriminatedUnion:()=>i.gM,effect:()=>i.QZ,enum:()=>i.k5,function:()=>i.fH,getErrorMap:()=>r.$W,getParsedType:()=>o.CR,instanceof:()=>i.Nl,intersection:()=>i.E$,isAborted:()=>s.G4,isAsync:()=>s.xP,isDirty:()=>s.DM,isValid:()=>s.fn,late:()=>i.fn,lazy:()=>i.RZ,literal:()=>i.eu,makeIssue:()=>s.y7,map:()=>i.Tj,nan:()=>i.oi,nativeEnum:()=>i.fc,never:()=>i.Zm,null:()=>i.ch,nullable:()=>i.me,number:()=>i.ai,object:()=>i.Ik,objectUtil:()=>o.o6,oboolean:()=>i.yN,onumber:()=>i.p7,optional:()=>i.lq,ostring:()=>i.Di,pipeline:()=>i.Tk,preprocess:()=>i.vk,promise:()=>i.iv,quotelessJson:()=>l.WI,record:()=>i.g1,set:()=>i.hZ,setErrorMap:()=>r.pJ,strictObject:()=>i.re,string:()=>i.Yj,symbol:()=>i.HR,transformer:()=>i.Gu,tuple:()=>i.PV,undefined:()=>i.Vx,union:()=>i.KC,unknown:()=>i.L5,util:()=>o.ZS,void:()=>i.rI});var r=a(54686),s=a(93298),o=a(14595),i=a(10663),l=a(63324);let c=n},23034:(e,t,a)=>{"use strict";a.d(t,{k:()=>c});var n=a(67850),r=a(24523),s=a(9620),o=a(85039),i=a(80658);async function l(e,t){let{projectRef:a}=e;if(!a)throw Error("projectRef is required");let{data:n,error:s}=await (0,r.Jt)("/platform/storage/{ref}/vector-buckets",{params:{path:{ref:a}},signal:t});return s&&(0,r.H4)(s),n}let c=function(e){let{projectRef:t}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:c}=(0,s.YA)(),d=(null==c?void 0:c.status)===o.BU.ACTIVE_HEALTHY;return(0,n.I)({queryKey:i.w.vectorBuckets(t),queryFn:e=>{let{signal:a}=e;return l({projectRef:t},a)},enabled:a&&void 0!==t&&d,...r})}},25822:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(86848).A)("SquarePlus",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},29556:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var n=a(80263),r=a(45984),s=a(91947),o=a(38912),i=a(62230),l=a(61767),c=a(78269);let d=e=>{let{bucketType:t,className:a,onCreateBucket:d}=e,u=l.TD[t];return(0,n.jsxs)(s.M,{icon:r.Zv,title:"Create ".concat(u.article," ").concat(u.singularName," bucket"),description:u.valueProp,className:a,"data-sentry-element":"EmptyStatePresentational","data-sentry-component":"EmptyBucketState","data-sentry-source-file":"EmptyBucketState.tsx",children:["files"===t&&(0,n.jsx)(i.c,{buttonSize:"tiny",buttonType:"primary",buttonClassName:"w-fit"}),"analytics"===t&&(0,n.jsx)(o.s,{buttonSize:"tiny",buttonType:"primary",buttonClassName:"w-fit"}),"vectors"===t&&(0,n.jsx)(c.C,{onClick:d})]})}},38912:(e,t,a)=>{"use strict";a.d(t,{s:()=>G});var n=a(80263),r=a(32981),s=a(72112),o=a(90376),i=a(80814),l=a(23850),c=a(87494),d=a(73969),u=a(19686),m=a(22891),y=a(23729),p=a(10723),f=a(78960),h=a(42018),g=a(51355),x=a(80210),b=a(24523),k=a(80658);async function v(e){let{projectRef:t,bucketName:a}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let{data:n,error:r}=await (0,b.bE)("/platform/storage/{ref}/analytics-buckets",{params:{path:{ref:t}},body:{bucketName:a}});return r&&(0,b.H4)(r),n}let j=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,g.jE)();return(0,x.n)({mutationFn:e=>v(e),async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries({queryKey:k.w.analyticsBuckets(s)}),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?d.oR.error("Failed to create analytics bucket: ".concat(e.message)):t(e,a,n)},...a})};var _=a(3413),w=a(43964),C=a(36261),B=a(80090),A=a(84512),S=a(9620),M=a(85039),z=a(95137),Z=a(80100),D=a(65887),E=a(27371),I=a(99779),N=a(44725),R=a(44053),T=a(61767),F=a(84988);let P=/^(?:xn--|sthree-|amzn-s3-demo-|aws)/,O=/(?:-s3alias|--ol-s3|--x-s3|--table-s3)$/,q=/^[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/,V=u.Ay.object({name:u.Ay.string().trim().min(3,"Bucket name should be at least 3 characters").max(63,"Bucket name should be up to 63 characters").refine(e=>!e.endsWith(" "),"The name of the bucket cannot end with a whitespace").refine(e=>"public"!==e,'"public" is a reserved name. Please choose another name')}).superRefine((e,t)=>{var a,n,r;if(P.test(e.name)){let[n]=null!=(a=e.name.match(P))?a:[];return t.addIssue({path:["name"],code:u.Ay.ZodIssueCode.custom,message:'Bucket name cannot start with "'.concat(n,'"')})}if(O.test(e.name)){let[a]=null!=(n=e.name.match(O))?n:[];return t.addIssue({path:["name"],code:u.Ay.ZodIssueCode.custom,message:'Bucket name cannot end with "'.concat(a,'"')})}if(/[A-Z]/.test(e.name))return t.addIssue({path:["name"],code:u.Ay.ZodIssueCode.custom,message:"Bucket name can only be lowercase characters"});if(!q.test(e.name)){if(!/^[a-z0-9]/.test(e.name))return t.addIssue({path:["name"],code:u.Ay.ZodIssueCode.custom,message:"Bucket name must start with a lowercase letter or number."});if(!/[a-z0-9]$/.test(e.name))return t.addIssue({path:["name"],code:u.Ay.ZodIssueCode.custom,message:"Bucket name must end with a lowercase letter or number."});let[a]=null!=(r=e.name.match(/[^a-z0-9-]/))?r:[];return t.addIssue({path:["name"],code:u.Ay.ZodIssueCode.custom,message:a?'Bucket name cannot contain the "'.concat(a,'" character'):"Bucket name contains an invalid special character"})}}),L="create-analytics-storage-bucket-form",G=e=>{var t,a;let{buttonSize:u="tiny",buttonType:g="default",buttonClassName:x,disabled:b=!1,tooltip:k}=e,v=(0,i.useRouter)(),{ref:P}=(0,m.g)(),{data:O}=(0,A.s)(),{data:q}=(0,S.YA)(),{can:G}=(0,B.Qp)(s.aG.STORAGE_WRITE,"*"),{extension:U,state:W}=(0,F.P)(),[Y,$]=(0,l.ZA)("new",l.cr.withDefault(!1).withOptions({history:"push",clearOnDefault:!0})),{data:K=[],isLoading:H}=(0,_.j)({projectRef:P}),J=(0,f.mM)({projectRef:P}),Q="needs-upgrade"===W,{mutate:X}=(0,C.h)(),{mutateAsync:ee,isPending:et}=j({onError:()=>{}}),{mutateAsync:ea,isPending:en}=(0,w.Z)(),{mutateAsync:er,isPending:es}=(0,h.E)(),eo=T.TD.analytics,ei=es||en||et,el=!G||!J||H||K.length>=2||b,ec=(0,c.mN)({resolver:(0,r.u)(V),defaultValues:{name:""}}),ed=async e=>{if(!P)return console.error("Project ref is required");if(!q)return console.error("Project details is required");if(!U)return console.error("Unable to find wrappers extension");if(K.some(t=>t.name===e.name))return d.oR.error("Bucket name already exists");try{var t,a;await ee({projectRef:P,bucketName:e.name}),"not-installed"===W?(await er({projectRef:null==q?void 0:q.ref,connectionString:null==q?void 0:q.connectionString,name:U.name,schema:null!=(t=U.schema)?t:"extensions",version:U.default_version}),await ea({bucketName:e.name})):"installed"===W&&await ea({bucketName:e.name}),X({action:"storage_bucket_created",properties:{bucketType:"analytics"},groups:{project:null!=P?P:"Unknown",organization:null!=(a=null==O?void 0:O.slug)?a:"Unknown"}}),ec.reset(),d.oR.success("Created bucket “".concat(e.name,"”")),$(!1),v.push("/project/".concat(P,"/storage/analytics/buckets/").concat(e.name))}catch(e){d.oR.error("Failed to create bucket: ".concat(e.message))}};return(0,n.jsxs)(z.lG,{open:Y,onOpenChange:e=>{e||(ec.reset(),$(!1))},"data-sentry-element":"Dialog","data-sentry-component":"CreateAnalyticsBucketModal","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,n.jsx)(z.zM,{asChild:!0,"data-sentry-element":"DialogTrigger","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:(0,n.jsx)(y.G,{block:!0,size:u,type:g,className:x,icon:(0,n.jsx)(o.A,{size:14}),disabled:el,style:{justifyContent:"start"},onClick:()=>$(!0),tooltip:{content:{side:(null==k||null==(t=k.content)?void 0:t.side)||"bottom",className:(0,Z.cn)(J?"":"w-72 text-center"),text:J?G?K.length>=2?"Bucket limit reached":null==k||null==(a=k.content)?void 0:a.text:"You need additional permissions to create buckets":"Analytics buckets are not enabled for your project. Please contact support to enable it."}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:"New bucket"})}),(0,n.jsxs)(z.Cf,{size:"large","aria-describedby":void 0,"data-sentry-element":"DialogContent","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,n.jsx)(z.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:(0,n.jsxs)(z.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:["Create ",eo.singularName," bucket"]})}),(0,n.jsx)(z.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx"}),(0,n.jsx)(D.lV,{...ec,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:(0,n.jsx)("form",{id:L,onSubmit:ec.handleSubmit(ed),children:(0,n.jsxs)(z.OO,{className:"flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,n.jsx)(D.zB,{name:"name",control:ec.control,render:e=>{let{field:t}=e;return(0,n.jsx)(R.M,{name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",description:"Must be between 3–63 characters. Only lowercase letters, numbers, and hyphens are allowed.",children:(0,n.jsx)(D.MJ,{children:(0,n.jsx)(E.p,{id:"name","data-1p-ignore":!0,"data-lpignore":"true","data-form-type":"other","data-bwignore":!0,...t,placeholder:"Enter bucket name"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx"},"name"),Q?(0,n.jsx)(N.Z,{type:"warning",title:"Wrappers extension must be updated for Iceberg Wrapper support",children:(0,n.jsxs)("p",{className:"prose max-w-full text-sm !leading-normal",children:["Update the ",(0,n.jsx)("code",{className:"text-code-inline",children:"wrappers"})," extension by upgrading your project from your"," ",(0,n.jsx)(p.g,{href:"/project/".concat(P,"/settings/infrastructure"),children:"project settings"})," ","before creating an Analytics bucket."," ",(0,n.jsx)(p.g,{href:"".concat(M.aq,"/guides/database/extensions/wrappers/iceberg"),children:"Learn more"}),"."]})}):(0,n.jsx)(N.Z,{type:"default",children:(0,n.jsxs)("p",{className:"!leading-normal",children:["Supabase will install the"," ","installed"!==W?"Wrappers extension and ":"","Iceberg Wrapper integration on your behalf."," ",(0,n.jsx)(p.g,{href:"".concat(M.aq,"/guides/database/extensions/wrappers/iceberg"),children:"Learn more"}),"."]})})]})})}),(0,n.jsxs)(z.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:[(0,n.jsx)(I.$,{type:"default",disabled:ei,onClick:()=>$(!1),"data-sentry-element":"Button","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:"Cancel"}),(0,n.jsx)(I.$,{form:L,htmlType:"submit",loading:ei,disabled:Q||ei,"data-sentry-element":"Button","data-sentry-source-file":"CreateAnalyticsBucketModal.tsx",children:"Create bucket"})]})]})]})}},42018:(e,t,a)=>{"use strict";a.d(t,{E:()=>m});var n=a(72391),r=a(29395),s=a(51355),o=a(80210),i=a(73969),l=a(30659),c=a(59356),d=a(87727);async function u(e){let{projectRef:t,connectionString:a,schema:s,name:o,version:i,cascade:l=!1,createSchema:d=!1}=e,u=new Headers;a&&u.set("x-connection-encrypted",a);let{sql:m}=n.A.extensions.create({schema:s,name:o,version:i,cascade:l}),{result:y}=await (0,c.E)({projectRef:t,connectionString:a,sql:d?"create schema if not exists ".concat((0,r.bD)(s),"; ").concat(m):m,queryKey:["extension","create"]});return y}let m=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,s.jE)();return(0,o.n)({mutationFn:e=>u(e),async onSuccess(t,a,r){let{projectRef:s}=a;await Promise.all([n.invalidateQueries({queryKey:d.I.list(s)}),n.invalidateQueries({queryKey:l.n.upgradeEligibility(s)})]),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?i.oR.error("Failed to enable database extension: ".concat(e.message)):t(e,a,n)},...a})}},42092:(e,t,a)=>{var n=a(48550),r=a(40293),s=a(92479),o=a(50084);e.exports=s(function(e,t){return o(e)?n(e,r(t,1,o,!0)):[]})},48550:(e,t,a)=>{var n=a(45558),r=a(10116),s=a(59568),o=a(71057),i=a(10876),l=a(99582);e.exports=function(e,t,a,c){var d=-1,u=r,m=!0,y=e.length,p=[],f=t.length;if(!y)return p;a&&(t=o(t,i(a))),c?(u=s,m=!1):t.length>=200&&(u=l,m=!1,t=new n(t));e:for(;++d<y;){var h=e[d],g=null==a?h:a(h);if(h=c||0!==h?h:0,m&&g==g){for(var x=f;x--;)if(t[x]===g)continue e;p.push(h)}else u(t,g,c)||p.push(h)}return p}},56492:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(86848).A)("Clock5",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 14.5 16",key:"1pcbox"}]])},62230:(e,t,a)=>{"use strict";a.d(t,{c:()=>P});var n=a(80263),r=a(32981),s=a(72112),o=a(90376),i=a(53239),l=a(87494),c=a(73969),d=a(19686),u=a(23850),m=a(22891),y=a(16581),p=a(23729),f=a(10723),h=a(78960),g=a(51355),x=a(80210),b=a(24523),k=a(80658);async function v(e){let{projectRef:t,id:a,type:n,isPublic:r,file_size_limit:s,allowed_mime_types:o}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let i={id:a,type:n,public:r};"STANDARD"===n&&(s&&(i.file_size_limit=s),o&&(i.allowed_mime_types=o));let{data:l,error:c}=await (0,b.bE)("/platform/storage/{ref}/buckets",{params:{path:{ref:t}},body:i});return c&&(0,b.H4)(c),l}let j=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,g.jE)();return(0,x.n)({mutationFn:e=>v(e),async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries({queryKey:k.w.buckets(s)}),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?c.oR.error("Failed to create bucket: ".concat(e.message)):t(e,a,n)},...a})};var _=a(36261),w=a(80090),C=a(84512),B=a(85039),A=a(95137),S=a(65887),M=a(27371),z=a(72608),Z=a(66329),D=a(99779),E=a(44725),I=a(44053),N=a(21993),R=a(12957);let T=d.Ay.object({name:d.Ay.string().trim().min(1,"Please provide a name for your bucket").max(100,"Bucket name should be below 100 characters").refine(e=>!e.endsWith(" "),"The name of the bucket cannot end with a whitespace").refine(e=>"public"!==e,'"public" is a reserved name. Please choose another name'),public:d.Ay.boolean().default(!1),has_file_size_limit:d.Ay.boolean().default(!1),formatted_size_limit:d.Ay.coerce.number().min(0,"File size upload limit has to be at least 0").optional(),allowed_mime_types:d.Ay.string().trim().default("")}).superRefine((e,t)=>{if(!N.Bt.test(e.name)){var a;let[n]=null!=(a=e.name.match(N.$P))?a:[];t.addIssue({path:["name"],code:d.Ay.ZodIssueCode.custom,message:n?'Bucket name cannot contain the "'.concat(n,'" character'):"Bucket name contains an invalid special character"})}}),F="create-storage-bucket-form",P=e=>{var t;let{buttonSize:a="tiny",buttonType:d="default",buttonClassName:g,label:x="New bucket"}=e,{ref:b}=(0,m.g)(),{data:k}=(0,C.s)(),[v,N]=(0,u.ZA)("new",u.cr.withDefault(!1).withOptions({history:"push",clearOnDefault:!0})),[P,O]=(0,i.useState)(y.s2.MB),[q,V]=(0,i.useState)(!1),{can:L}=(0,w.Qp)(s.aG.STORAGE_WRITE,"*"),{data:G}=(0,h.Ij)({projectRef:b},{enabled:B.pe}),{value:U,unit:W}=(0,R.Jb)(null!=(t=null==G?void 0:G.fileSizeLimit)?t:0),Y="".concat(U," ").concat(W),{mutate:$}=(0,_.h)(),{mutateAsync:K,isPending:H}=j({onError:()=>{}}),J=(0,l.mN)({resolver:(0,r.u)(T),defaultValues:{name:"",public:!1,has_file_size_limit:!1,formatted_size_limit:void 0,allowed_mime_types:""}}),{formatted_size_limit:Q}=J.formState.errors,X=J.watch("public"),ee=J.watch("has_file_size_limit"),et=async e=>{var t,a;if(!b)return console.error("Project ref is required");try{let a=e.has_file_size_limit&&void 0!==e.formatted_size_limit?(0,R.OG)(e.formatted_size_limit,P):void 0,n=q&&e.allowed_mime_types.length>0?e.allowed_mime_types.split(",").map(e=>e.trim()):void 0;if(a&&(null==G?void 0:G.fileSizeLimit)&&a>G.fileSizeLimit)return J.setError("formatted_size_limit",{type:"manual",message:"exceed_global_limit"});await K({projectRef:b,id:e.name,type:"STANDARD",isPublic:e.public,file_size_limit:a,allowed_mime_types:n}),$({action:"storage_bucket_created",properties:{bucketType:"STANDARD"},groups:{project:null!=b?b:"Unknown",organization:null!=(t=null==k?void 0:k.slug)?t:"Unknown"}}),c.oR.success("Successfully created bucket ".concat(e.name)),J.reset(),O(y.s2.MB),N(!1)}catch(t){let e=(null==(a=t.message)?void 0:a.toLowerCase())||"";e.includes("mime type")&&(e.includes("is not supported")||e.includes("not supported"))?J.setError("allowed_mime_types",{type:"manual",message:"Invalid MIME type format. Please check your input."}):c.oR.error("Failed to create bucket: ".concat(t.message))}};return(0,n.jsxs)(A.lG,{open:v,onOpenChange:e=>{e||(J.reset(),O(y.s2.MB),N(!1))},"data-sentry-element":"Dialog","data-sentry-component":"CreateBucketModal","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,n.jsx)(A.zM,{asChild:!0,"data-sentry-element":"DialogTrigger","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,n.jsx)(p.G,{block:!0,size:a,type:d,className:g,icon:(0,n.jsx)(o.A,{size:14}),disabled:!L,style:{justifyContent:"start"},onClick:()=>N(!0),tabIndex:L?0:-1,tooltip:{content:{side:"bottom",text:L?void 0:"You need additional permissions to create buckets"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"CreateBucketModal.tsx",children:x})}),(0,n.jsxs)(A.Cf,{"aria-describedby":void 0,"data-sentry-element":"DialogContent","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,n.jsx)(A.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,n.jsx)(A.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateBucketModal.tsx",children:"Create file bucket"})}),(0,n.jsx)(A.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,n.jsx)(S.lV,{...J,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,n.jsxs)("form",{id:F,onSubmit:J.handleSubmit(et),children:[(0,n.jsx)(A.OO,{className:"flex flex-col gap-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,n.jsx)(S.zB,{name:"name",control:J.control,render:e=>{let{field:t}=e;return(0,n.jsx)(I.M,{name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",children:(0,n.jsx)(S.MJ,{children:(0,n.jsx)(M.p,{id:"name","data-1p-ignore":!0,"data-lpignore":"true","data-form-type":"other","data-bwignore":!0,...t,placeholder:"Enter bucket name"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx"},"name")}),(0,n.jsx)(A.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,n.jsxs)(A.OO,{className:"space-y-3","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,n.jsx)(S.zB,{name:"public",control:J.control,render:e=>{let{field:t}=e;return(0,n.jsx)(I.M,{hideMessage:!0,name:"public",label:"Public bucket",description:"Allow anyone to read objects without authorization",layout:"flex",children:(0,n.jsx)(S.MJ,{children:(0,n.jsx)(z.d,{id:"public",size:"large",checked:t.value,onCheckedChange:t.onChange})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx"},"public"),X&&(0,n.jsx)(E.Z,{type:"warning",title:"Public buckets are not protected",description:"Users can read objects in public buckets without any authorization. Row level security (RLS) policies are still required for other operations such as object uploads and deletes."})]}),(0,n.jsx)(A.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,n.jsxs)(A.OO,{className:"space-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,n.jsx)(S.zB,{name:"has_file_size_limit",control:J.control,render:e=>{let{field:t}=e;return(0,n.jsx)(I.M,{name:"has_file_size_limit",label:"Restrict file size",description:"Prevent uploading of files larger than a specified limit",layout:"flex",children:(0,n.jsx)(S.MJ,{children:(0,n.jsx)(z.d,{id:"has_file_size_limit",size:"large",checked:t.value,onCheckedChange:t.onChange})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx"},"has_file_size_limit"),ee&&(0,n.jsxs)("div",{children:[(0,n.jsx)(S.zB,{name:"formatted_size_limit",control:J.control,render:e=>{let{field:t}=e;return(0,n.jsx)(I.M,{hideMessage:!0,name:"formatted_size_limit",label:"File size limit",children:(0,n.jsxs)("div",{className:"grid grid-cols-12 gap-x-2",children:[(0,n.jsx)("div",{className:"col-span-8",children:(0,n.jsx)(S.MJ,{children:(0,n.jsx)(M.p,{id:"formatted_size_limit","aria-label":"File size limit",type:"number",min:0,placeholder:"0",...t})})}),(0,n.jsx)("div",{className:"col-span-4",children:(0,n.jsxs)(Z.l6,{value:P,onValueChange:O,children:[(0,n.jsx)(Z.bq,{"aria-label":"File size limit unit",size:"small",children:(0,n.jsx)(Z.yv,{children:P})}),(0,n.jsx)(Z.gC,{children:Object.values(y.s2).map(e=>(0,n.jsx)(Z.eb,{value:e,className:"text-xs",children:e},e))})]})})]})})}},"formatted_size_limit"),(null==Q?void 0:Q.message)==="exceed_global_limit"&&(0,n.jsxs)(S.C5,{className:"mt-2",children:["Exceeds global limit of ",Y,". Increase limit in"," ",(0,n.jsx)(f.g,{className:"text-destructive decoration-destructive-500 hover:decoration-destructive",href:"/project/".concat(b,"/storage/settings"),onClick:()=>N(!1),children:"Storage Settings"})," ","first."]}),B.pe&&(0,n.jsxs)("p",{className:"text-sm text-foreground-lighter mt-2",children:["This project has a"," ",(0,n.jsx)(f.g,{className:"text-foreground-light hover:text-foreground",href:"/project/".concat(b,"/storage/settings"),onClick:()=>N(!1),children:"global file size limit"})," ","of ",Y,"."]})]})]}),(0,n.jsx)(A.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateBucketModal.tsx"}),(0,n.jsxs)(A.OO,{className:"space-y-2","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,n.jsx)(I.M,{name:"has_allowed_mime_types",label:"Restrict MIME types",description:"Allow only certain types of files to be uploaded",layout:"flex","data-sentry-element":"FormItemLayout","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,n.jsx)(S.MJ,{"data-sentry-element":"FormControl_Shadcn_","data-sentry-source-file":"CreateBucketModal.tsx",children:(0,n.jsx)(z.d,{id:"has_allowed_mime_types",size:"large",checked:q,onCheckedChange:V,"data-sentry-element":"Switch","data-sentry-source-file":"CreateBucketModal.tsx"})})}),q&&(0,n.jsx)(S.zB,{name:"allowed_mime_types",control:J.control,render:e=>{let{field:t}=e;return(0,n.jsx)(I.M,{name:"allowed_mime_types",label:"Allowed MIME types",labelOptional:"Comma separated values",description:"Wildcards are allowed, e.g. image/*.",children:(0,n.jsx)(S.MJ,{children:(0,n.jsx)(M.p,{id:"allowed_mime_types",...t,placeholder:"e.g image/jpeg, image/png, audio/mpeg, video/mp4, etc"})})})}},"allowed_mime_types")]})]})}),(0,n.jsxs)(A.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"CreateBucketModal.tsx",children:[(0,n.jsx)(D.$,{type:"default",disabled:H,onClick:()=>N(!1),"data-sentry-element":"Button","data-sentry-source-file":"CreateBucketModal.tsx",children:"Cancel"}),(0,n.jsx)(D.$,{form:F,htmlType:"submit",loading:H,disabled:H,"data-sentry-element":"Button","data-sentry-source-file":"CreateBucketModal.tsx",children:"Create"})]})]})]})}},63685:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(86848).A)("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]])},64382:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(86848).A)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]])},70825:(e,t,a)=>{"use strict";a.d(t,{Eo:()=>i,Xn:()=>o,YF:()=>s});var n=a(52793),r=a.n(n);let s=e=>"".concat(r()(e),"_keys"),o=e=>"fdw_vector_".concat(r()(e)),i=e=>"".concat(r()(e),"_fdw")},78269:(e,t,a)=>{"use strict";a.d(t,{C:()=>O,G:()=>q});var n=a(80263),r=a(32981),s=a(72112),o=a(90376),i=a(53239),l=a(87494),c=a(73969),d=a(19686),u=a(22891),m=a(23729),y=a(10723),p=a(42018),f=a(53404),h=a(11658),g=a(51355),x=a(80210),b=a(24523),k=a(80658);async function v(e){let{projectRef:t,bucketName:a}=e;if(!t)throw Error("projectRef is required");if(!a)throw Error("Bucket name is required");let{data:n,error:r}=await (0,b.bE)("/platform/storage/{ref}/vector-buckets",{params:{path:{ref:t}},body:{bucketName:a}});return r&&(0,b.H4)(r),n}let j=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,g.jE)();return(0,x.n)({mutationFn:e=>v(e),async onSuccess(t,a,r){let{projectRef:s}=a;await n.invalidateQueries({queryKey:k.w.vectorBuckets(s)}),await (null==e?void 0:e(t,a,r))},async onError(e,a,n){void 0===t?c.oR.error("Failed to create vector bucket: ".concat(e.message)):t(e,a,n)},...a})};var _=a(23034),w=a(36261),C=a(80090),B=a(84512),A=a(9620),S=a(85039),M=a(95137),z=a(65887),Z=a(27371),D=a(99779),E=a(44725),I=a(44053);let N=/^[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/;var R=a(88445),T=a(70825);let F=d.Ay.object({name:d.Ay.string().trim().min(3,"Bucket name should be at least 3 characters").max(63,"Bucket name should be up to 63 characters").superRefine((e,t)=>{if(!N.test(e)){var a;if(/[A-Z]/.test(e))return t.addIssue({path:[],code:d.Ay.ZodIssueCode.custom,message:"Bucket name can only be lowercase characters"});if(!/^[a-z0-9]/.test(e))return t.addIssue({path:[],code:d.Ay.ZodIssueCode.custom,message:"Bucket name must start with a lowercase letter or number."});if(!/[a-z0-9]$/.test(e))return t.addIssue({path:[],code:d.Ay.ZodIssueCode.custom,message:"Bucket name must end with a lowercase letter or number."});let[n]=null!=(a=e.match(/[^a-z0-9-]/))?a:[];return t.addIssue({path:[],code:d.Ay.ZodIssueCode.custom,message:n?'Bucket name cannot contain the "'.concat(n,'" character'):"Bucket name contains an invalid special character"})}})}),P="create-storage-bucket-form",O=e=>{let{onClick:t}=e,{can:a}=(0,C.Qp)(s.aG.STORAGE_WRITE,"*");return(0,n.jsx)(m.G,{block:!0,size:"tiny",type:"primary",className:"w-fit",icon:(0,n.jsx)(o.A,{size:14}),disabled:!a,onClick:t,tooltip:{content:{side:"bottom",text:a?void 0:"You need additional permissions to create buckets"}},"data-sentry-element":"ButtonTooltip","data-sentry-component":"CreateVectorBucketButton","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"New bucket"})},q=e=>{let{visible:t,setVisible:a}=e,{ref:s}=(0,u.g)(),{data:o}=(0,B.s)(),{data:d}=(0,A.YA)(),[m,g]=(0,i.useState)(!1),{data:x}=(0,_.k)({projectRef:s}),b=(0,l.mN)({resolver:(0,r.u)(F),defaultValues:{name:""}}),{mutate:k}=(0,w.h)(),{mutateAsync:v}=j({onError:()=>{}}),{extension:C,state:N}=(0,R.k)(),{mutateAsync:O}=(0,h.y)(),{mutateAsync:q}=(0,f.C)({onError:()=>{}}),{mutateAsync:V}=(0,p.E)(),L=async e=>{var t,n,r;if(!s)return console.error("Project ref is required");if((null!=(t=null==x?void 0:x.vectorBuckets)?t:[]).some(t=>t.vectorBucketName===e.name))return c.oR.error("Bucket name already exists");g(!0);try{await v({projectRef:s,bucketName:e.name})}catch(e){c.oR.error("Failed to create vector bucket: ".concat(e.message)),g(!1);return}try{if(!C)throw Error("Unable to find wrappers extension.");"not-installed"===N?(await V({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,name:C.name,schema:null!=(n=C.schema)?n:"extensions",version:C.default_version}),await O({bucketName:e.name}),await q({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,name:(0,T.Xn)(e.name)})):"installed"===N&&(await O({bucketName:e.name}),await q({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,name:(0,T.Xn)(e.name)}))}catch(e){c.oR.warning("Failed to create vector bucket integration: ".concat(e.message,". The bucket will be created but you will need to manually install the integration."))}g(!1),k({action:"storage_bucket_created",properties:{bucketType:"vector"},groups:{project:null!=s?s:"Unknown",organization:null!=(r=null==o?void 0:o.slug)?r:"Unknown"}}),c.oR.success("Successfully created vector bucket ".concat(e.name)),b.reset(),a(!1)};return(0,i.useEffect)(()=>{t||b.reset()},[t,b]),(0,n.jsx)(M.lG,{open:t,onOpenChange:a,"data-sentry-element":"Dialog","data-sentry-component":"CreateVectorBucketDialog","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,n.jsxs)(M.Cf,{"data-sentry-element":"DialogContent","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,n.jsx)(M.c7,{"data-sentry-element":"DialogHeader","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,n.jsx)(M.L3,{"data-sentry-element":"DialogTitle","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Create vector bucket"})}),(0,n.jsx)(M.pf,{"data-sentry-element":"DialogSectionSeparator","data-sentry-source-file":"CreateVectorBucketDialog.tsx"}),(0,n.jsx)(z.lV,{...b,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,n.jsx)("form",{id:P,onSubmit:b.handleSubmit(L),children:(0,n.jsxs)(M.OO,{className:"flex flex-col gap-y-4","data-sentry-element":"DialogSection","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,n.jsx)(z.zB,{name:"name",control:b.control,render:e=>{let{field:t}=e;return(0,n.jsx)(I.M,{name:"name",label:"Bucket name",labelOptional:"Cannot be changed after creation",description:"A target schema will be created that matches this name.",children:(0,n.jsx)(z.MJ,{children:(0,n.jsx)(Z.p,{id:"name","data-1p-ignore":!0,"data-lpignore":"true","data-form-type":"other","data-bwignore":!0,...t,placeholder:"Enter bucket name"})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateVectorBucketDialog.tsx"},"name"),(0,n.jsx)(E.Z,{type:"default","data-sentry-element":"Admonition","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:(0,n.jsxs)("p",{children:["Supabase will install the"," ","installed"!==N?"Wrappers extension and ":"","S3 Vectors Wrapper integration on your behalf."," ",(0,n.jsx)(y.g,{href:"".concat(S.aq,"/guides/database/extensions/wrappers/s3-vectors"),"data-sentry-element":"InlineLink","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Learn more"}),"."]})})]})})}),(0,n.jsxs)(M.Es,{"data-sentry-element":"DialogFooter","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:[(0,n.jsx)(D.$,{type:"default",disabled:m,onClick:()=>a(!1),"data-sentry-element":"Button","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Cancel"}),(0,n.jsx)(D.$,{form:P,htmlType:"submit",loading:m,"data-sentry-element":"Button","data-sentry-source-file":"CreateVectorBucketDialog.tsx",children:"Create"})]})]})})}},88445:(e,t,a)=>{"use strict";a.d(t,{k:()=>o});var n=a(93784),r=a(22730),s=a(9620);let o=()=>{var e,t;let{data:a}=(0,s.YA)(),{data:o,isLoading:i}=(0,r.z)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString}),l=n.o.find(e=>"s3_vectors_wrapper"===e.id);if(!l||"wrapper"!==l.type)return{extension:void 0,state:"not-found"};let c=l.meta,d=null==o?void 0:o.find(e=>"wrappers"===e.name),u=!!(null==d?void 0:d.installed_version),m=(null!=(e=null==d?void 0:d.installed_version)?e:"")>=(null!=(t=null==c?void 0:c.minimumExtensionVersion)?t:"");return{extension:d,state:i?"loading":u?m?"installed":"needs-upgrade":"not-installed"}}},94637:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});let n=(0,a(86848).A)("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]])}}]);