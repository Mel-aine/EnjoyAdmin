try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5d2f506d-3163-403c-b5b5-5d67b6518c9c",e._sentryDebugIdIdentifier="sentry-dbid-5d2f506d-3163-403c-b5b5-5d67b6518c9c")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51775],{3109:(e,t,a)=>{"use strict";a.d(t,{$:()=>i});var s=a(39691),l=a(62550),n=a(11164),r=a(9620);let i=()=>{let{data:e,isLoading:t}=(0,r.YA)(),{data:a=[],isLoading:i}=(0,n.p)({projectRef:null==e?void 0:e.ref}),{data:d=[],isLoading:c}=(0,l.j)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,schema:"storage"}),o=d.filter(e=>"objects"===e.table),u=(0,s._S)(a,o);return{getPolicyCount:e=>{var t,a;return null!=(a=null==(t=u.find(t=>t.name===e))?void 0:t.policies.length)?a:0},isLoading:t||i||c}}},57320:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/storage/files",function(){return a(62485)}])},62485:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>J});var s=a(80263),l=a(31092),n=a(96040),r=a(53239),i=a(22891),d=a(44168),c=a(10723),o=a(53931),u=a(78960),m=a(11164),x=a(85039),y=a(6436),h=a(51537),f=a(21162),b=a(99779),p=a(78039),j=a(44725),g=a(64758),k=a(45218),T=a(14354),B=a(62230),w=a(29556),v=a(62941),N=a(80100),_=a(78511);let z=(0,r.createContext)(null),C=e=>{let{scrollContainerProps:t,containerProps:a,data:l,children:n,overscan:i=5,estimateSize:d,getItemKey:c,...o}=e,u=(0,r.useRef)(null),m=(0,r.useCallback)((e,t)=>c?c(e,t):t,[c]),x=(0,r.useCallback)(e=>{let t=l[e];return t?m(t,e):e},[l,m]),y=(0,v.Te)({count:l.length,getScrollElement:()=>u.current,overscan:i,estimateSize:d,getItemKey:x}),h=y.getVirtualItems(),f=y.getTotalSize(),b=h.length>0?h[0].start:0,p=h.length>0?f-h[h.length-1].end:0,j=(0,r.useMemo)(()=>({virtualizer:y,virtualItems:h,data:l,paddingTop:b,paddingBottom:p,getRowKey:m}),[y,h,l,b,p,m]),g=(0,r.useMemo)(()=>({...a,className:(0,N.cn)("overflow-visible",null==a?void 0:a.className)}),[a]),{className:k,...T}=null!=t?t:{};return(0,s.jsx)("div",{ref:u,className:(0,N.cn)("h-full overflow-auto",k),...T,"data-sentry-component":"VirtualizedTable","data-sentry-source-file":"VirtualizedTable.tsx",children:(0,s.jsx)(z.Provider,{value:j,"data-sentry-element":"VirtualizedTableContext.Provider","data-sentry-source-file":"VirtualizedTable.tsx",children:(0,s.jsx)(_.XI,{containerProps:g,...o,"data-sentry-element":"Table","data-sentry-source-file":"VirtualizedTable.tsx",children:n})})})},S=e=>{let{emptyContent:t,leadingContent:a,trailingContent:l,children:n,paddingColSpan:d=1,paddingCellClassName:c,...o}=e,{virtualizer:u,virtualItems:m,data:x,paddingTop:y,paddingBottom:h,getRowKey:f}=(()=>{let e=(0,r.useContext)(z);if(!e)throw Error("VirtualizedTable components must be used within a VirtualizedTable");return e})(),b=u.measureElement;return(0,s.jsxs)(_.BF,{...o,"data-sentry-element":"TableBody","data-sentry-component":"VirtualizedTableBody","data-sentry-source-file":"VirtualizedTable.tsx",children:[a,0===x.length?null!=t?t:null:(0,s.jsxs)(s.Fragment,{children:[y>0&&(0,s.jsx)(_.Hj,{"aria-hidden":"true",style:{height:y},children:(0,s.jsx)(P,{colSpan:d,className:(0,N.cn)("p-0",c)})}),m.map(e=>{var t;let a=x[e.index];if(void 0===a)return null;let s=n(a,e.index);if(!(0,r.isValidElement)(s))return s;let l=null!=(t=s.key)?t:f(a,e.index),d=s.ref,c=null!=d?(0,i.Px)(b,d):b;return(0,r.cloneElement)(s,{key:l,ref:c,"data-index":e.index})}),h>0&&(0,s.jsx)(_.Hj,{"aria-hidden":"true",style:{height:h},children:(0,s.jsx)(P,{colSpan:d,className:(0,N.cn)("p-0",c)})})]}),l]})},A=_.A0,I=(0,r.forwardRef)((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(_.nd,{ref:t,className:(0,N.cn)("sticky top-0 z-10 bg-200",a),...l})});I.displayName="VirtualizedTableHead";let H=_.Hj,P=_.nA;var R=a(3109),V=a(45984),E=a(76196),D=a(3701),L=a(21650);let F=e=>{let{mode:t,hasBuckets:a=!0}=e,l="standard"===t?_.A0:A,n="standard"===t?_.Hj:H,r="standard"===t?_.nd:I,i="sticky top-0 z-10 bg-200";return(0,s.jsx)(l,{"data-sentry-element":"BucketTableHeader","data-sentry-component":"BucketTableHeader","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsxs)(n,{"data-sentry-element":"BucketTableRow","data-sentry-source-file":"BucketTable.tsx",children:[a&&(0,s.jsx)(r,{className:"".concat(i," w-2 pr-1"),children:(0,s.jsx)("span",{className:"sr-only",children:"Icon"})}),(0,s.jsx)(r,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:"Name"}),(0,s.jsx)(r,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:"Policies"}),(0,s.jsx)(r,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:"File size limit"}),(0,s.jsx)(r,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:"Allowed MIME types"}),(0,s.jsx)(r,{className:i,"data-sentry-element":"BucketTableHead","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)("span",{className:"sr-only",children:"Actions"})})]})})},M=e=>{let{mode:t,filterString:a}=e,l="standard"===t?_.Hj:H,n="standard"===t?_.nA:P;return(0,s.jsx)(l,{className:"[&>td]:hover:bg-inherit","data-sentry-element":"BucketTableRow","data-sentry-component":"BucketTableEmptyState","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsxs)(n,{colSpan:5,"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-lighter",children:["Your search for “",a,"” did not return any results"]})]})})},K=e=>{let{mode:t,bucket:a,projectRef:l,formattedGlobalUploadLimit:n}=e,r=(0,D.useRouter)(),{getPolicyCount:i}=(0,R.$)(),d="standard"===t?_.Hj:H,c="standard"===t?_.nA:P,o=(e,t)=>{let a="/project/".concat(l,"/storage/files/buckets/").concat(encodeURIComponent(e));t.metaKey||t.ctrlKey?window.open("".concat(x.o2).concat(a),"_blank"):r.push(a)};return(0,s.jsxs)(d,{"data-bucket-id":a.id,className:"relative cursor-pointer h-16 group inset-focus",onClick:e=>o(a.id,e),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o(a.id,e))},tabIndex:0,"data-sentry-element":"BucketTableRow","data-sentry-component":"BucketTableRow","data-sentry-source-file":"BucketTable.tsx",children:[(0,s.jsx)(c,{className:"w-2 pr-1","data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)(V.O7,{"aria-label":"bucket icon",size:16,className:"text-foreground-muted","data-sentry-element":"FilesBucketIcon","data-sentry-source-file":"BucketTable.tsx"})}),(0,s.jsx)(c,{className:"flex-1","data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,s.jsx)("p",{className:"whitespace-nowrap max-w-[512px] truncate",children:a.id}),a.public&&(0,s.jsx)(L.E,{variant:"warning",children:"Public"})]})}),(0,s.jsx)(c,{"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)("p",{className:"text-foreground-light",children:i(a.id)})}),(0,s.jsx)(c,{"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)("p",{className:"whitespace-nowrap ".concat(a.file_size_limit?"text-foreground-light":"text-foreground-muted"),children:a.file_size_limit?(0,y.z3)(a.file_size_limit):"Unset (".concat(n,")")})}),(0,s.jsx)(c,{"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:(0,s.jsx)("p",{className:a.allowed_mime_types?"text-foreground-light":"text-foreground-muted",children:a.allowed_mime_types?a.allowed_mime_types.join(", "):"Any"})}),(0,s.jsxs)(c,{"data-sentry-element":"BucketTableCell","data-sentry-source-file":"BucketTable.tsx",children:[(0,s.jsx)("div",{className:"flex justify-end items-center h-full",children:(0,s.jsx)(E.A,{"aria-hidden":!0,size:14,className:"text-foreground-muted/60","data-sentry-element":"ChevronRight","data-sentry-source-file":"BucketTable.tsx"})}),(0,s.jsx)("button",{tabIndex:-1,className:"sr-only",children:"Go to bucket details"})]})]},a.id)},U=e=>e.buckets.length>50?(0,s.jsx)(G,{...e,"data-sentry-element":"BucketsTableVirtualized","data-sentry-component":"BucketsTable","data-sentry-source-file":"BucketsTable.tsx"}):(0,s.jsx)(q,{...e,"data-sentry-element":"BucketsTableUnvirtualized","data-sentry-component":"BucketsTable","data-sentry-source-file":"BucketsTable.tsx"}),q=e=>{let{buckets:t,projectRef:a,filterString:l,formattedGlobalUploadLimit:n}=e,r=0===t.length&&l.length>0;return(0,s.jsxs)(_.XI,{containerProps:{containerClassName:"h-full overflow-auto",className:"overflow-visible"},"data-sentry-element":"Table","data-sentry-component":"BucketsTableUnvirtualized","data-sentry-source-file":"BucketsTable.tsx",children:[(0,s.jsx)(F,{mode:"standard",hasBuckets:t.length>0,"data-sentry-element":"BucketTableHeader","data-sentry-source-file":"BucketsTable.tsx"}),(0,s.jsx)(_.BF,{"data-sentry-element":"TableBody","data-sentry-source-file":"BucketsTable.tsx",children:r?(0,s.jsx)(M,{mode:"standard",filterString:l}):t.map(e=>(0,s.jsx)(K,{mode:"standard",bucket:e,projectRef:a,formattedGlobalUploadLimit:n},e.id))})]})},G=e=>{let{buckets:t,projectRef:a,filterString:l,formattedGlobalUploadLimit:n}=e,r=0===t.length&&l.length>0;return(0,s.jsxs)(C,{data:t,estimateSize:()=>59,getItemKey:e=>e.id,"data-sentry-element":"VirtualizedTable","data-sentry-component":"BucketsTableVirtualized","data-sentry-source-file":"BucketsTable.tsx",children:[(0,s.jsx)(F,{mode:"virtualized",hasBuckets:t.length>0,"data-sentry-element":"BucketTableHeader","data-sentry-source-file":"BucketsTable.tsx"}),(0,s.jsx)(S,{paddingColSpan:5,emptyContent:r?(0,s.jsx)(M,{mode:"virtualized",filterString:l}):void 0,"data-sentry-element":"VirtualizedTableBody","data-sentry-source-file":"BucketsTable.tsx",children:e=>(0,s.jsx)(K,{mode:"virtualized",bucket:e,projectRef:a,formattedGlobalUploadLimit:n},e.id)})]})},X=()=>{var e;let{ref:t}=(0,i.g)(),a=(0,h.$)(),[v,N]=(0,r.useState)(""),{data:_}=(0,u.Ij)({projectRef:t},{enabled:x.pe}),{data:z=[],error:C,isError:S,isLoading:A,isSuccess:I}=(0,m.p)({projectRef:t}),H=(0,y.z3)(null!=(e=null==_?void 0:_.fileSizeLimit)?e:0),P=z.filter(e=>!("type"in e)||"STANDARD"===e.type).filter(e=>0===v.length||e.id.toLowerCase().includes(v.toLowerCase())),R=0===z.filter(e=>!("type"in e)||"STANDARD"===e.type).length,V=S&&C.message.includes("Project has no active API keys"),E=(0,r.useMemo)(()=>"alphabetical"===a.sortBucket?P.sort((e,t)=>e.id.toLowerCase().trim().localeCompare(t.id.toLowerCase().trim())):P.sort((e,t)=>new Date(t.created_at)>new Date(e.created_at)?1:-1),[P,a.sortBucket]);return(0,s.jsx)(k.L,{"data-sentry-element":"PageContainer","data-sentry-component":"FilesBuckets","data-sentry-source-file":"index.tsx",children:(0,s.jsx)(T.d8,{"data-sentry-element":"PageSection","data-sentry-source-file":"index.tsx",children:(0,s.jsxs)(T.KP,{className:"h-full gap-y-4","data-sentry-element":"PageSectionContent","data-sentry-source-file":"index.tsx",children:[A&&(0,s.jsx)(o.yV,{}),S&&(0,s.jsx)(s.Fragment,{children:V?(0,s.jsx)(j.Z,{type:"warning",title:"Project has no active API keys enabled",children:(0,s.jsxs)("p",{className:"!leading-normal text-sm",children:["The Dashboard relies on having active API keys on the project to function. If you'd like to use Storage through the Dashboard, create a set of API keys"," ",(0,s.jsx)(c.g,{href:"/project/".concat(t,"/settings/api-keys/new"),children:"here"}),"."]})}):(0,s.jsx)(d.A,{error:C,subject:"Failed to retrieve buckets"})}),I&&(0,s.jsx)(s.Fragment,{children:R?(0,s.jsx)(w.Z,{bucketType:"files"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-grow justify-between gap-x-2 items-center mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(g.p,{size:"tiny",className:"flex-grow lg:flex-grow-0 w-52",placeholder:"Search for a bucket",value:v,onChange:e=>N(e.target.value),icon:(0,s.jsx)(l.A,{})}),(0,s.jsxs)(f.rI,{children:[(0,s.jsx)(f.ty,{asChild:!0,children:(0,s.jsxs)(b.$,{type:"default",icon:(0,s.jsx)(n.A,{}),children:["Sorted by ","alphabetical"===a.sortBucket?"name":"created at"]})}),(0,s.jsx)(f.SQ,{align:"start",className:"w-40",children:(0,s.jsxs)(f.Hr,{value:a.sortBucket,onValueChange:e=>a.setSortBucket(e),children:[(0,s.jsx)(f.Ht,{value:"alphabetical",children:"Sort by name"}),(0,s.jsx)(f.Ht,{value:"created_at",children:"Sort by created at"})]})})]})]}),(0,s.jsx)(B.c,{buttonType:"primary",buttonClassName:"w-fit"})]}),(0,s.jsx)(p.Zp,{children:(0,s.jsx)(U,{buckets:E,projectRef:null!=t?t:"_",filterString:v,formattedGlobalUploadLimit:H})})]})})]})})})};var Y=a(57393),$=a(87829),O=a(27843);let Z=()=>(0,s.jsx)(X,{"data-sentry-element":"FilesBuckets","data-sentry-component":"StorageFilesPage","data-sentry-source-file":"index.tsx"});Z.getLayout=e=>(0,s.jsx)(Y.A,{children:(0,s.jsx)(O.A,{title:"Storage",children:(0,s.jsx)($.D,{children:e})})});let J=Z},62550:(e,t,a)=>{"use strict";a.d(t,{j:()=>o});var s=a(67850),l=a(78510),n=a(24523),r=a(9620),i=a(85039),d=a(30399);async function c(e,t,a){let{projectRef:s,connectionString:r,schema:i}=e;if(!s)throw Error("projectRef is required");let d=new Headers(a);r&&d.set("x-connection-encrypted",r);let{data:c,error:o}=await (0,n.Jt)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":r,"x-pg-application-name":l.r},path:{ref:s},query:{included_schemas:i||"",excluded_schemas:""}},headers:d,signal:t});return o&&(0,n.H4)(o),c}let o=function(e){let{projectRef:t,connectionString:a,schema:l}=e,{enabled:n=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:u}=(0,r.YA)(),m=(null==u?void 0:u.status)===i.BU.ACTIVE_HEALTHY;return(0,s.I)({queryKey:d.S.list(t,l),queryFn:e=>{let{signal:s}=e;return c({projectRef:t,connectionString:a,schema:l},s)},enabled:n&&void 0!==t&&m,...o})}},96040:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(86848).A)("ArrowDownNarrowWide",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h4",key:"6d7r33"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h10",key:"1438ji"}]])}},e=>{e.O(0,[92376,60858,15599,16110,76391,36538,32421,62941,33736,76984,72391,35035,40545,596,57393,75187,29471,12182,75095,91922,94063,90636,46593,38792],()=>e(e.s=57320)),_N_E=e.O()}]);